{"version":3,"file":"static/webpack/static/development/pages/index.js.2b0d779ce8537612cf7b.hot-update.js","sources":["webpack:///./pages/index.js"],"sourcesContent":["import Component from 'react'\nimport Link from 'next/link'\nimport Head from 'next/head'\n// import { Near } from 'nearlib'\n\nconst accountId = \"alice.near\";\nconst contractName = \"metanear\";\n\nclass Grid extends React.Component {\n    componentDidMount() {\n        const canvas = this.refs.canvas\n        const ctx = canvas.getContext(\"2d\")\n        for (let i = 0; i < this.props.width / this.props.cellWidth; ++i) {\n            ctx.beginPath()\n            ctx.moveTo(i * this.props.cellWidth, 0)\n            ctx.lineTo(i * this.props.cellWidth, this.props.height)\n            ctx.stroke()\n        }\n        for (let i = 0; i < this.props.height / this.props.cellHeight; ++i) {\n            ctx.beginPath()\n            ctx.moveTo(0, i * this.props.cellHeight)\n            ctx.lineTo(this.props.width, i * this.props.cellHeight)\n            ctx.stroke()\n        }\n        for (let i = 0; i < this.props.cells.length; ++i) {\n            ctx.fillRect(\n                (this.props.cells[i].location.x) * this.props.cellWidth,\n                (this.props.cells[i].location.y) * this.props.cellHeight,\n                this.props.cellWidth,\n                this.props.cellHeight)\n        }\n        ctx.beginPath()\n        ctx.arc((this.props.playerX + 0.5) * this.props.cellWidth, (this.props.playerY + 0.5) * this.props.cellHeight, this.props.cellWidth / 2 - 3, 0, 2 * Math.PI)\n        ctx.stroke()\n        document.addEventListener('mousemove', this.onMouseMove, false)\n    }\n    componentWillUnmount() {\n        document.removeEventListener('mousemove', this.onMouseMove, false)\n    }\n    onMouseMove = (e) => {\n        this.props.onHighlight(Math.floor(e.offsetX / this.props.cellWidth), Math.floor(e.offsetY / this.props.cellHeight))\n    }\n    render() {\n        return (\n            <canvas ref=\"canvas\" width={this.props.width} height={this.props.height} />\n        )\n    }\n}\n\nclass WalletLogin extends React.Component {\n    render() {\n        return (\n            <div id=\"sign-in-container\">\n                <h2> Hello stranger! Who are you?</h2>\n                <div id=\"login-form\">\n                    <div class=\"col-md-4\"><button onClick={this.props.onClick} id=\"login-button\" class=\"btn btn-lg btn-block btn-primary\">Login with NEAR Wallet</button></div>\n                </div>\n            </div> \n        )\n    }\n}\n\nclass WalletLogout extends React.Component {\n    render() {\n        return (<div>Hello</div>)\n    }\n}\n\nclass Game extends React.Component {\n    constructor(props) {\n        super(props)\n        this.state = { \n            cells: [{ location: { x: 1, y: 1 }, viewIndex: 1, contractId: \"ads\", webUrl: \"123\", owner: \"xyz\" }], \n            highlighCell: {},\n            player: {location: {x: 0, y: 0}}\n        }\n        this.walletAccount = null\n    }\n    nearConnect = async () => {\n        this.walletAccount = new nearlib.WalletAccount(contractName, \"https://wallet.nearprotocol.com/\");\n        const accountId = walletAccount.getAccountId();\n        console.log(accountId)\n        const near = new nearlib.Near(new nearlib.NearClient(\n            this.walletAccount,\n            new nearlib.LocalNodeConnection(\"https://studio.nearprotocol.com/devnet\"),\n        ));\n        this.contract = await near.loadContract(contractName, {\n            viewMethods: [\"lookAround\", \"getPlayer\"],\n            changeMethods: [],\n            sender: accountId,\n        });\n        let view = await this.contract.lookAround()\n        console.log(view)\n        // let player = await this.contract.getPlayer({accountId: this.state.accountId})\n        // console.log(player)\n        this.setState({cells: view.cells || []})\n    }\n    componentDidMount() {\n        this.nearConnect();\n    }\n    onHighlight = (x, y) => {\n        let highlighCell = {}\n        for (let i = 0; i < this.state.cells.length; ++i) {\n            if (this.state.cells[i].location.x == x && this.state.cells[i].location.y == y) {\n                highlighCell = this.state.cells[i]\n                break\n            }\n        }\n        this.setState({highlighCell})\n    }\n    render() {\n        let control;\n        if (this.walletAccount && this.walletAccount.isSignedIn()) {\n            contorl = <WalletLogout onClick={this.logout} />\n        } else {\n            control = <WalletLogin onClick={this.login} />\n        }\n        return (\n            <div>\n                {control}\n                <Grid width={640} height={425} cellWidth={20} cellHeight={20} cells={this.state.cells} onHighlight={this.onHighlight} playerX={this.state.player.location.x} playerY={this.state.player.location.y} />\n                <div>Highlighted cell: {JSON.stringify(this.state.highlighCell)}</div>\n                <div>Player: {JSON.stringify(this.state.player)}</div>\n            </div>\n        )\n    }\n}\n\nexport default function Index() {\n    return (\n        <div>\n            <Head>\n                <script src=\"https://cdn.jsdelivr.net/npm/nearlib@0.4.2/dist/nearlib.js\"></script>\n            </Head>\n            <div>\n                <Game accountId=\"illia.near\" />\n            </div>\n        </div>\n    )\n}"],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAAA;AACA;AACA;AACA;AAEA;AACA;AACA;AACA;;;;;;;;;;;;;;;;;;AA+BA;AACA;AACA;AACA;;;;;;AAjCA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AAKA;AACA;AAAA;AACA;AACA;AACA;AACA;;;AACA;AACA;AACA;;;AAIA;AACA;AACA;AAAA;AAAA;AAAA;AAEA;;;;AAtCA;AACA;AAwCA;;;;;;;;;;;;;AACA;AACA;AACA;AAAA;AAEA;AAAA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAIA;;;;AAVA;AACA;AAYA;;;;;;;;;;;;;AACA;AACA;AACA;;;;AAHA;AACA;AAKA;;;;;AACA;AAAA;AACA;AADA;AACA;AAAA;AACA;AAFA;AAAA;AAAA;AAAA;AAAA;AASA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AAJA;AAAA;AASA;AACA;AACA;AAHA;AACA;AATA;AAQA;AARA;AAAA;AACA;AADA;AAaA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAlBA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AAVA;AAgCA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAvCA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AAAA;AAAA;AAAA;AAHA;AAKA;AAPA;AAQA;AACA;;;AAmBA;AACA;AACA;;;AAWA;AACA;AACA;AAAA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAAA;AACA;AACA;AAAA;AAGA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAKA;;;;AAzDA;AACA;AA2DA;AACA;AAGA;AAAA;AAGA;AAAA;AAIA;;;;A","sourceRoot":""}