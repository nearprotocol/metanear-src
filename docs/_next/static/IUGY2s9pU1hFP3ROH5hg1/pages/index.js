(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"2wwy":function(t,e,n){t.exports=n("nhzr")},"9Jkg":function(t,e,n){t.exports=n("oh+g")},E8gZ:function(t,e,n){var l=n("w6GO"),r=n("NsO/"),o=n("NV0k").f;t.exports=function(t){return function(e){for(var n,a=r(e),i=l(a),c=i.length,s=0,u=[];c>s;)o.call(a,n=i[s++])&&u.push(t?[n,a[n]]:a[n]);return u}}},RNiq:function(t,e,n){"use strict";n.r(e);var l=n("ln6h"),r=n.n(l),o=n("UXZV"),a=n.n(o),i=n("O40h"),c=n("2wwy"),s=n.n(c),u=n("0iUn"),h=n("sLSF"),p=n("MI3g"),f=n("a7VT"),d=n("AT/M"),v=n("Tit0"),g=n("hfKm"),y=n.n(g);function m(t,e,n){return e in t?y()(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var b=n("9Jkg"),w=n.n(b),O=n("q1tI"),k=n.n(O),C=(n("YFqc"),n("PgRs")),E=n.n(C);n.d(e,"default",function(){return P});var j="metanear",A="Meta NEAR",x="http://localhost:3000",_=function(t){return w()(t)},N=function(t){return _(t.location)},W=function(t){function e(){var t,n;Object(u.default)(this,e);for(var l=arguments.length,r=new Array(l),o=0;o<l;o++)r[o]=arguments[o];return n=Object(p.default)(this,(t=Object(f.default)(e)).call.apply(t,[this].concat(r))),m(Object(d.default)(n),"onMouseMove",function(t){n.props.onHighlight(Math.floor(t.offsetX/n.props.cellWidth),Math.floor(t.offsetY/n.props.cellHeight))}),n}return Object(v.default)(e,t),Object(h.default)(e,[{key:"componentDidUpdate",value:function(t,e,n){var l=this,r=this.refs.canvas.getContext("2d");r.clearRect(0,0,this.props.width,this.props.height),r.fillStyle="#FF0000";for(var o=0;o<this.props.width/this.props.cellWidth;++o)r.beginPath(),r.moveTo(o*this.props.cellWidth,0),r.lineTo(o*this.props.cellWidth,this.props.height),r.stroke();for(var a=0;a<this.props.height/this.props.cellHeight;++a)r.beginPath(),r.moveTo(0,a*this.props.cellHeight),r.lineTo(this.props.width,a*this.props.cellHeight),r.stroke();s()(this.props.allCells).forEach(function(t){r.fillStyle=["#AA6666","#AAAA66","#AA66AA","#6666AA","#333333"][t.viewIndex],r.fillRect(t.location.x*l.props.cellWidth,t.location.y*l.props.cellHeight,l.props.cellWidth,l.props.cellHeight)}),s()(this.props.cells).forEach(function(t){r.fillStyle=["#FF9999","#FFFF99","#FF99FF","#9999FF","#666666"][t.viewIndex],r.fillRect(t.location.x*l.props.cellWidth,t.location.y*l.props.cellHeight,l.props.cellWidth,l.props.cellHeight)}),r.beginPath(),r.arc((this.props.playerX+.5)*this.props.cellWidth,(this.props.playerY+.5)*this.props.cellHeight,this.props.cellWidth/2-3,0,2*Math.PI),r.stroke(),document.addEventListener("mousemove",this.onMouseMove,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.onMouseMove,!1)}},{key:"render",value:function(){return k.a.createElement("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,onClick:this.props.onClick})}}]),e}(k.a.Component),M=function(t){function e(){return Object(u.default)(this,e),Object(p.default)(this,Object(f.default)(e).apply(this,arguments))}return Object(v.default)(e,t),Object(h.default)(e,[{key:"render",value:function(){return k.a.createElement("div",{id:"sign-in-container"},k.a.createElement("h2",null," Hello stranger! Who are you?"),k.a.createElement("div",{id:"login-form"},k.a.createElement("div",{className:"col-md-4"},k.a.createElement("button",{onClick:this.props.onClick,id:"login-button",className:"btn btn-lg btn-block btn-primary"},"Login with NEAR Wallet"))))}}]),e}(k.a.Component),H=function(t){function e(){return Object(u.default)(this,e),Object(p.default)(this,Object(f.default)(e).apply(this,arguments))}return Object(v.default)(e,t),Object(h.default)(e,[{key:"render",value:function(){return k.a.createElement("div",{id:"hello"},k.a.createElement("h2",{id:"hello"},"Hi, ",this.props.accountId,"!"))}}]),e}(k.a.Component),I=function(t){function e(){return Object(u.default)(this,e),Object(p.default)(this,Object(f.default)(e).apply(this,arguments))}return Object(v.default)(e,t),Object(h.default)(e,[{key:"render",value:function(){return k.a.createElement("iframe",{src:this.props.url,width:640,height:480})}}]),e}(k.a.Component),F=function(t){function e(t){var n;return Object(u.default)(this,e),n=Object(p.default)(this,Object(f.default)(e).call(this,t)),m(Object(d.default)(n),"fetchCells",function(){var t=Object(i.default)(r.a.mark(function t(e){var l,o;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.contract.lookAround({accountId:e});case 2:l=t.sent,console.log(l),o={},l.cells&&l.cells.forEach(function(t){o[N(t)]=t}),n.setState({cells:o,allCells:a()(n.state.allCells,o)});case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),m(Object(d.default)(n),"nearConnect",Object(i.default)(r.a.mark(function t(){var e,l,o;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.walletAccount=new nearlib.WalletAccount(j,"https://wallet.nearprotocol.com/"),e=n.walletAccount.getAccountId(),console.log(e),l=new nearlib.Near(new nearlib.NearClient(n.walletAccount,new nearlib.LocalNodeConnection("https://studio.nearprotocol.com/devnet"))),t.next=6,l.loadContract(j,{viewMethods:["lookAround","getPlayer"],changeMethods:["move","deploy"],sender:e});case 6:return n.contract=t.sent,window.contract=n.contract,t.next=10,n.fetchCells(e);case 10:if(!e){t.next=16;break}return t.next=13,n.contract.getPlayer({accountId:e});case 13:o=t.sent,console.log(o),n.setState({player:o});case 16:case"end":return t.stop()}},t)}))),m(Object(d.default)(n),"onHighlight",function(t,e){var l=n.state.allCells[_({x:t,y:e})]||{};n.setState({highlighCell:l})}),m(Object(d.default)(n),"login",function(){n.walletAccount.requestSignIn(j,A,x+"/",x+"/")}),m(Object(d.default)(n),"logout",function(){}),m(Object(d.default)(n),"movePlayer",function(){var t=0,e=0;1==Math.abs(n.state.player.location.x-n.state.highlighCell.location.x)?t=n.state.player.location.x>n.state.highlighCell.location.x?-1:1:1==Math.abs(n.state.player.location.y-n.state.highlighCell.location.y)&&(e=n.state.player.location.y>n.state.highlighCell.location.y?-1:1),n.contract.move({dx:t,dy:e}).then(function(){var t=n.walletAccount.getAccountId();n.contract.getPlayer({accountId:t}).then(function(){var e=Object(i.default)(r.a.mark(function e(l){return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(l),n.setState({player:l}),e.next=4,n.fetchCells(t);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})}),n.state={cells:{},allCells:{},highlighCell:{},player:null},n.walletAccount=null,n}return Object(v.default)(e,t),Object(h.default)(e,[{key:"componentDidMount",value:function(){this.nearConnect()}},{key:"render",value:function(){var t;t=this.walletAccount&&this.walletAccount.isSignedIn()?k.a.createElement(H,{accountId:this.walletAccount.getAccountId(),onClick:this.logout}):k.a.createElement(M,{onClick:this.login});var e=null;return this.state.player&&(e=this.state.cells[_(this.state.player.location)]),k.a.createElement("div",null,t,k.a.createElement(W,{width:640,height:425,cellWidth:20,cellHeight:20,cells:this.state.cells,allCells:this.state.allCells,onHighlight:this.onHighlight,playerX:this.state.player&&this.state.player.location.x,playerY:this.state.player&&this.state.player.location.y,onClick:this.movePlayer}),k.a.createElement("div",null,"Highlighted cell: ",w()(this.state.highlighCell)),k.a.createElement("div",null,"Player: ",w()(this.state.player)),e&&k.a.createElement(I,{url:e.webUrl,contractId:e.contractId}))}}]),e}(k.a.Component);function P(){return k.a.createElement("div",null,k.a.createElement(E.a,null,k.a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/nearlib@0.4.2/dist/nearlib.js"})),k.a.createElement("div",null,k.a.createElement(F,null)))}},YFqc:function(t,e,n){t.exports=n("cTJO")},cTJO:function(t,e,n){"use strict";var l=n("KI45"),r=l(n("9Jkg")),o=l(n("iZP3")),a=l(n("/HRN")),i=l(n("WaGi")),c=l(n("ZDA2")),s=l(n("/+P4")),u=l(n("N9n2")),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},p=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var f=n("CxY0"),d=h(n("q1tI")),v=(p(n("17x9")),h(n("20a2"))),g=n("Bu4q");var y=function(t){function e(){var t,n,l,r,i;return(0,a.default)(this,e),(t=(0,c.default)(this,(0,s.default)(e).apply(this,arguments))).formatUrls=(n=function(t,e){return{href:t&&"object"===(0,o.default)(t)?g.formatWithValidation(t):t,as:e&&"object"===(0,o.default)(e)?g.formatWithValidation(e):e}},l=null,r=null,i=null,function(t,e){if(t===l&&e===r)return i;var o=n(t,e);return l=t,r=e,i=o,o}),t.linkClicked=function(e){var n=e.currentTarget,l=n.nodeName,r=n.target;if("A"!==l||!(r&&"_self"!==r||e.metaKey||e.ctrlKey||e.shiftKey||e.nativeEvent&&2===e.nativeEvent.which)){var o=t.formatUrls(t.props.href,t.props.as),a=o.href,i=o.as;if(function(t){var e=f.parse(t,!1,!0),n=f.parse(g.getLocationOrigin(),!1,!0);return!e.host||e.protocol===n.protocol&&e.host===n.host}(a)){var c=window.location.pathname;a=f.resolve(c,a),i=i?f.resolve(c,i):a,e.preventDefault();var s=t.props.scroll;null==s&&(s=i.indexOf("#")<0),v.default[t.props.replace?"replace":"push"](a,i,{shallow:t.props.shallow}).then(function(t){t&&s&&(window.scrollTo(0,0),document.body.focus())}).catch(function(e){t.props.onError&&t.props.onError(e)})}}},t}return(0,u.default)(e,t),(0,i.default)(e,[{key:"componentDidMount",value:function(){this.prefetch()}},{key:"componentDidUpdate",value:function(t){(0,r.default)(this.props.href)!==(0,r.default)(t.href)&&this.prefetch()}},{key:"prefetch",value:function(){if(this.props.prefetch&&"undefined"!=typeof window){var t=window.location.pathname,e=this.formatUrls(this.props.href,this.props.as).href,n=f.resolve(t,e);v.default.prefetch(n)}}},{key:"render",value:function(){var t=this,e=this.props.children,n=this.formatUrls(this.props.href,this.props.as),l=n.href,r=n.as;"string"==typeof e&&(e=d.default.createElement("a",null,e));var o=d.Children.only(e),a={onClick:function(e){o.props&&"function"==typeof o.props.onClick&&o.props.onClick(e),e.defaultPrevented||t.linkClicked(e)}};return!this.props.passHref&&("a"!==o.type||"href"in o.props)||(a.href=r||l),a.href&&"undefined"!=typeof __NEXT_DATA__&&__NEXT_DATA__.nextExport&&(a.href=v.Router._rewriteUrlForNextExport(a.href)),d.default.cloneElement(o,a)}}]),e}(d.Component);e.default=y},fW1p:function(t,e,n){var l=n("Y7ZC"),r=n("E8gZ")(!1);l(l.S,"Object",{values:function(t){return r(t)}})},nhzr:function(t,e,n){n("fW1p"),t.exports=n("WEpk").Object.values},"oh+g":function(t,e,n){var l=n("WEpk"),r=l.JSON||(l.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}},vlRD:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){var t=n("RNiq");return{page:t.default||t}}])}},[["vlRD",1,0]]]);