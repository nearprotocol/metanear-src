(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{"9Jkg":function(t,e,n){t.exports=n("oh+g")},RNiq:function(t,e,n){"use strict";n.r(e);var l=n("9Jkg"),o=n.n(l),a=n("ln6h"),r=n.n(a),i=n("O40h"),c=n("0iUn"),s=n("sLSF"),u=n("MI3g"),h=n("a7VT"),p=n("AT/M"),f=n("Tit0"),d=n("hfKm"),v=n.n(d);function g(t,e,n){return e in t?v()(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var m=n("q1tI"),y=n.n(m),b=(n("YFqc"),n("PgRs")),w=n.n(b);n.d(e,"default",function(){return M});var k="metanear",O="Meta NEAR",j="http://localhost:3000",E=function(t){function e(){var t,n;Object(c.default)(this,e);for(var l=arguments.length,o=new Array(l),a=0;a<l;a++)o[a]=arguments[a];return n=Object(u.default)(this,(t=Object(h.default)(e)).call.apply(t,[this].concat(o))),g(Object(p.default)(n),"onMouseMove",function(t){n.props.onHighlight(Math.floor(t.offsetX/n.props.cellWidth),Math.floor(t.offsetY/n.props.cellHeight))}),n}return Object(f.default)(e,t),Object(s.default)(e,[{key:"componentDidUpdate",value:function(t,e,n){var l=this.refs.canvas.getContext("2d");l.clearRect(0,0,this.props.width,this.props.height),l.fillStyle="#FF0000";for(var o=0;o<this.props.width/this.props.cellWidth;++o)l.beginPath(),l.moveTo(o*this.props.cellWidth,0),l.lineTo(o*this.props.cellWidth,this.props.height),l.stroke();for(var a=0;a<this.props.height/this.props.cellHeight;++a)l.beginPath(),l.moveTo(0,a*this.props.cellHeight),l.lineTo(this.props.width,a*this.props.cellHeight),l.stroke();for(var r=0;r<this.props.cells.length;++r)l.fillRect(this.props.cells[r].location.x*this.props.cellWidth,this.props.cells[r].location.y*this.props.cellHeight,this.props.cellWidth,this.props.cellHeight);l.beginPath(),l.arc((this.props.playerX+.5)*this.props.cellWidth,(this.props.playerY+.5)*this.props.cellHeight,this.props.cellWidth/2-3,0,2*Math.PI),l.stroke(),document.addEventListener("mousemove",this.onMouseMove,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.onMouseMove,!1)}},{key:"render",value:function(){return y.a.createElement("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,onClick:this.props.onClick})}}]),e}(y.a.Component),C=function(t){function e(){return Object(c.default)(this,e),Object(u.default)(this,Object(h.default)(e).apply(this,arguments))}return Object(f.default)(e,t),Object(s.default)(e,[{key:"render",value:function(){return y.a.createElement("div",{id:"sign-in-container"},y.a.createElement("h2",null," Hello stranger! Who are you?"),y.a.createElement("div",{id:"login-form"},y.a.createElement("div",{className:"col-md-4"},y.a.createElement("button",{onClick:this.props.onClick,id:"login-button",className:"btn btn-lg btn-block btn-primary"},"Login with NEAR Wallet"))))}}]),e}(y.a.Component),x=function(t){function e(){return Object(c.default)(this,e),Object(u.default)(this,Object(h.default)(e).apply(this,arguments))}return Object(f.default)(e,t),Object(s.default)(e,[{key:"render",value:function(){return y.a.createElement("div",{id:"hello"},y.a.createElement("h2",{id:"hello"},"Hi, ",this.props.accountId,"!"))}}]),e}(y.a.Component),A=function(t){function e(){return Object(c.default)(this,e),Object(u.default)(this,Object(h.default)(e).apply(this,arguments))}return Object(f.default)(e,t),Object(s.default)(e,[{key:"render",value:function(){return y.a.createElement("iframe",{src:this.props.url})}}]),e}(y.a.Component),_=function(t){function e(t){var n;return Object(c.default)(this,e),n=Object(u.default)(this,Object(h.default)(e).call(this,t)),g(Object(p.default)(n),"nearConnect",Object(i.default)(r.a.mark(function t(){var e,l,o,a;return r.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.walletAccount=new nearlib.WalletAccount(k,"https://wallet.nearprotocol.com/"),e=n.walletAccount.getAccountId(),console.log(e),l=new nearlib.Near(new nearlib.NearClient(n.walletAccount,new nearlib.LocalNodeConnection("https://studio.nearprotocol.com/devnet"))),t.next=6,l.loadContract(k,{viewMethods:["lookAround","getPlayer"],changeMethods:["move"],sender:e});case 6:return n.contract=t.sent,t.next=9,n.contract.lookAround({accountId:e});case 9:if(o=t.sent,console.log(o),n.setState({cells:o.cells||[]}),!e){t.next=18;break}return t.next=15,n.contract.getPlayer({accountId:e});case 15:a=t.sent,console.log(a),n.setState({player:a});case 18:case"end":return t.stop()}},t)}))),g(Object(p.default)(n),"onHighlight",function(t,e){for(var l={},o=0;o<n.state.cells.length;++o)if(n.state.cells[o].location.x==t&&n.state.cells[o].location.y==e){l=n.state.cells[o];break}n.setState({highlighCell:l})}),g(Object(p.default)(n),"login",function(){n.walletAccount.requestSignIn(k,O,j+"/",j+"/")}),g(Object(p.default)(n),"logout",function(){}),g(Object(p.default)(n),"movePlayer",function(){var t=0,e=0;1==Math.abs(n.state.player.location.x-n.state.highlighCell.location.x)?t=n.state.player.location.x>n.state.highlighCell.location.x?-1:1:1==Math.abs(n.state.player.location.y-n.state.highlighCell.location.y)&&(e=n.state.player.location.y>n.state.highlighCell.location.y?-1:1),n.contract.move({dx:t,dy:e}).then(function(){var t=n.walletAccount.getAccountId();n.contract.getPlayer({accountId:t}).then(function(){var e=Object(i.default)(r.a.mark(function e(l){var o;return r.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(l),n.setState({player:l}),e.next=4,n.contract.lookAround({accountId:t});case 4:o=e.sent,console.log(o),n.setState({cells:o.cells||[]});case 7:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})}),n.state={cells:[],highlighCell:{},player:null},n.walletAccount=null,n}return Object(f.default)(e,t),Object(s.default)(e,[{key:"componentDidMount",value:function(){this.nearConnect()}},{key:"render",value:function(){var t;t=this.walletAccount&&this.walletAccount.isSignedIn()?y.a.createElement(x,{accountId:this.walletAccount.getAccountId(),onClick:this.logout}):y.a.createElement(C,{onClick:this.login});var e=null;if(this.state.player){for(var n=0;n<this.state.cells.length;++n)if(this.state.cells[n].location.x==this.state.player.location.x&&this.state.cells[n].location.y==this.state.player.location.y){e=this.state.cells[n];break}console.log("I'm in "+o()(this.state.player)+o()(e))}return y.a.createElement("div",null,t,y.a.createElement(E,{width:640,height:425,cellWidth:20,cellHeight:20,cells:this.state.cells,onHighlight:this.onHighlight,playerX:this.state.player&&this.state.player.location.x,playerY:this.state.player&&this.state.player.location.y,onClick:this.movePlayer}),y.a.createElement("div",null,"Highlighted cell: ",o()(this.state.highlighCell)),y.a.createElement("div",null,"Player: ",o()(this.state.player)),e&&y.a.createElement(A,{url:e.webUrl,contractId:e.contractId}))}}]),e}(y.a.Component);function M(){return y.a.createElement("div",null,y.a.createElement(w.a,null,y.a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/nearlib@0.4.2/dist/nearlib.js"})),y.a.createElement("div",null,y.a.createElement(_,null)))}},YFqc:function(t,e,n){t.exports=n("cTJO")},cTJO:function(t,e,n){"use strict";var l=n("KI45"),o=l(n("9Jkg")),a=l(n("iZP3")),r=l(n("/HRN")),i=l(n("WaGi")),c=l(n("ZDA2")),s=l(n("/+P4")),u=l(n("N9n2")),h=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},p=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var f=n("CxY0"),d=h(n("q1tI")),v=(p(n("17x9")),h(n("20a2"))),g=n("Bu4q");var m=function(t){function e(){var t,n,l,o,i;return(0,r.default)(this,e),(t=(0,c.default)(this,(0,s.default)(e).apply(this,arguments))).formatUrls=(n=function(t,e){return{href:t&&"object"===(0,a.default)(t)?g.formatWithValidation(t):t,as:e&&"object"===(0,a.default)(e)?g.formatWithValidation(e):e}},l=null,o=null,i=null,function(t,e){if(t===l&&e===o)return i;var a=n(t,e);return l=t,o=e,i=a,a}),t.linkClicked=function(e){var n=e.currentTarget,l=n.nodeName,o=n.target;if("A"!==l||!(o&&"_self"!==o||e.metaKey||e.ctrlKey||e.shiftKey||e.nativeEvent&&2===e.nativeEvent.which)){var a=t.formatUrls(t.props.href,t.props.as),r=a.href,i=a.as;if(function(t){var e=f.parse(t,!1,!0),n=f.parse(g.getLocationOrigin(),!1,!0);return!e.host||e.protocol===n.protocol&&e.host===n.host}(r)){var c=window.location.pathname;r=f.resolve(c,r),i=i?f.resolve(c,i):r,e.preventDefault();var s=t.props.scroll;null==s&&(s=i.indexOf("#")<0),v.default[t.props.replace?"replace":"push"](r,i,{shallow:t.props.shallow}).then(function(t){t&&s&&(window.scrollTo(0,0),document.body.focus())}).catch(function(e){t.props.onError&&t.props.onError(e)})}}},t}return(0,u.default)(e,t),(0,i.default)(e,[{key:"componentDidMount",value:function(){this.prefetch()}},{key:"componentDidUpdate",value:function(t){(0,o.default)(this.props.href)!==(0,o.default)(t.href)&&this.prefetch()}},{key:"prefetch",value:function(){if(this.props.prefetch&&"undefined"!=typeof window){var t=window.location.pathname,e=this.formatUrls(this.props.href,this.props.as).href,n=f.resolve(t,e);v.default.prefetch(n)}}},{key:"render",value:function(){var t=this,e=this.props.children,n=this.formatUrls(this.props.href,this.props.as),l=n.href,o=n.as;"string"==typeof e&&(e=d.default.createElement("a",null,e));var a=d.Children.only(e),r={onClick:function(e){a.props&&"function"==typeof a.props.onClick&&a.props.onClick(e),e.defaultPrevented||t.linkClicked(e)}};return!this.props.passHref&&("a"!==a.type||"href"in a.props)||(r.href=o||l),r.href&&"undefined"!=typeof __NEXT_DATA__&&__NEXT_DATA__.nextExport&&(r.href=v.Router._rewriteUrlForNextExport(r.href)),d.default.cloneElement(a,r)}}]),e}(d.Component);e.default=m},"oh+g":function(t,e,n){var l=n("WEpk"),o=l.JSON||(l.JSON={stringify:JSON.stringify});t.exports=function(t){return o.stringify.apply(o,arguments)}},vlRD:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){var t=n("RNiq");return{page:t.default||t}}])}},[["vlRD",1,0]]]);