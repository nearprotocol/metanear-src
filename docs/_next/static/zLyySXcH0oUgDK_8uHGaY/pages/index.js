(window.webpackJsonp=window.webpackJsonp||[]).push([[5],{"2wwy":function(t,e,n){t.exports=n("nhzr")},"9Jkg":function(t,e,n){t.exports=n("oh+g")},E8gZ:function(t,e,n){var l=n("w6GO"),r=n("NsO/"),o=n("NV0k").f;t.exports=function(t){return function(e){for(var n,a=r(e),i=l(a),c=i.length,s=0,u=[];c>s;)o.call(a,n=i[s++])&&u.push(t?[n,a[n]]:a[n]);return u}}},RNiq:function(t,e,n){"use strict";n.r(e);var l=n("pLtp"),r=n.n(l),o=n("ln6h"),a=n.n(o),i=n("UXZV"),c=n.n(i),s=n("O40h"),u=n("2wwy"),p=n.n(u),h=n("0iUn"),f=n("sLSF"),d=n("MI3g"),v=n("a7VT"),g=n("AT/M"),y=n("Tit0"),m=n("hfKm"),w=n.n(m);function b(t,e,n){return e in t?w()(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}var O=n("9Jkg"),E=n.n(O),j=n("q1tI"),k=n.n(j),C=(n("YFqc"),n("PgRs")),x=n.n(C);n.d(e,"default",function(){return J});var M="metanear",A="cell:",W="Meta NEAR",_=function(t){return E()(t)},N=function(t){return _(t.location)},H=function(t){return"rgb(".concat(Math.round(86*t),", ").concat(Math.round(125*t),", ").concat(Math.round(70*t),")")},I=function(t){function e(){var t,n;Object(h.default)(this,e);for(var l=arguments.length,r=new Array(l),o=0;o<l;o++)r[o]=arguments[o];return n=Object(d.default)(this,(t=Object(v.default)(e)).call.apply(t,[this].concat(r))),b(Object(g.default)(n),"onMouseMove",function(t){var e=n.props.width/2-n.props.cellWidth/2,l=n.props.height/2-n.props.cellHeight/2;n.props.onHighlight(Math.floor((t.offsetX-e)/n.props.cellWidth)+n.props.playerX,Math.floor((t.offsetY-l)/n.props.cellHeight)+n.props.playerY)}),n}return Object(y.default)(e,t),Object(f.default)(e,[{key:"componentDidUpdate",value:function(t,e,n){var l=this,r=this.refs.canvas.getContext("2d");r.clearRect(0,0,this.props.width,this.props.height),r.fillStyle="#FF0000";for(var o=this.props.width/2-this.props.cellWidth/2,a=this.props.height/2-this.props.cellHeight/2,i=this.props.width/this.props.cellWidth,c=this.props.height/this.props.cellHeight,s=-i/2;s<i/2;++s)r.beginPath(),r.moveTo(o+s*this.props.cellWidth,0),r.lineTo(o+s*this.props.cellWidth,this.props.height),r.stroke();for(var u=-c;u<c;++u)r.beginPath(),r.moveTo(0,a+(u-.7)*this.props.cellHeight),r.lineTo(this.props.width,a+(u-.7)*this.props.cellHeight),r.stroke();p()(this.props.allCells).forEach(function(t){N(t)in l.props.cells||(r.fillStyle=[H(.5),H(.45),H(.4),H(.35),"#883333"][t.viewIndex],r.fillRect(o+(t.location.x-l.props.playerX)*l.props.cellWidth,a+(t.location.y-l.props.playerY)*l.props.cellHeight,l.props.cellWidth,l.props.cellHeight))}),p()(this.props.cells).forEach(function(t){r.fillStyle=[H(1),H(.9),H(.8),H(.7),"#FF6666"][t.viewIndex],r.fillRect(o+(t.location.x-l.props.playerX)*l.props.cellWidth,a+(t.location.y-l.props.playerY)*l.props.cellHeight,l.props.cellWidth,l.props.cellHeight)}),r.beginPath(),r.arc(o+.5*this.props.cellWidth,a+.5*this.props.cellHeight,this.props.cellWidth/2-3,0,2*Math.PI),r.stroke(),document.addEventListener("mousemove",this.onMouseMove,!1)}},{key:"componentWillUnmount",value:function(){document.removeEventListener("mousemove",this.onMouseMove,!1)}},{key:"render",value:function(){return k.a.createElement("canvas",{ref:"canvas",width:this.props.width,height:this.props.height,onClick:this.props.onClick})}}]),e}(k.a.Component),T=function(t){function e(){return Object(h.default)(this,e),Object(d.default)(this,Object(v.default)(e).apply(this,arguments))}return Object(y.default)(e,t),Object(f.default)(e,[{key:"render",value:function(){return k.a.createElement("div",{id:"sign-in-container"},k.a.createElement("h2",null," Hello stranger! Who are you?"),k.a.createElement("div",{id:"login-form"},k.a.createElement("div",{className:"col-md-4"},k.a.createElement("button",{onClick:this.props.onClick,id:"login-button",className:"btn btn-lg btn-block btn-primary"},"Login with NEAR Wallet"))))}}]),e}(k.a.Component),S=function(t){function e(){return Object(h.default)(this,e),Object(d.default)(this,Object(v.default)(e).apply(this,arguments))}return Object(y.default)(e,t),Object(f.default)(e,[{key:"render",value:function(){return k.a.createElement("div",{id:"hello"},k.a.createElement("h2",{id:"hello"},"Hi, ",this.props.accountId,"!"))}}]),e}(k.a.Component),P=function(t){function e(){return Object(h.default)(this,e),Object(d.default)(this,Object(v.default)(e).apply(this,arguments))}return Object(y.default)(e,t),Object(f.default)(e,[{key:"render",value:function(){return k.a.createElement("iframe",{src:this.props.url,width:640,height:480})}}]),e}(k.a.Component),R=function(t){function e(t){var n;return Object(h.default)(this,e),n=Object(d.default)(this,Object(v.default)(e).call(this,t)),b(Object(g.default)(n),"fetchCells",function(){var t=Object(s.default)(a.a.mark(function t(e){var l,r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,n.contract.lookAround({accountId:e});case 2:l=t.sent,console.log(l),r={},l.cells&&l.cells.forEach(function(t){r[N(t)]=t,localStorage.setItem(A+N(t),E()(t))}),n.setState({cells:r,allCells:c()(n.state.allCells,r)});case 7:case"end":return t.stop()}},t)}));return function(e){return t.apply(this,arguments)}}()),b(Object(g.default)(n),"nearConnect",Object(s.default)(a.a.mark(function t(){var e,l,r;return a.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n.walletAccount=new nearlib.WalletAccount(M,"https://wallet.nearprotocol.com/"),e=n.walletAccount.getAccountId(),console.log(e),l=new nearlib.Near(new nearlib.NearClient(n.walletAccount,new nearlib.LocalNodeConnection("https://studio.nearprotocol.com/devnet"))),t.next=6,l.loadContract(M,{viewMethods:["lookAround","getPlayer"],changeMethods:["move","deploy"],sender:e});case 6:return n.contract=t.sent,window.contract=n.contract,t.next=10,n.fetchCells(e);case 10:if(!e){t.next=16;break}return t.next=13,n.contract.getPlayer({accountId:e});case 13:r=t.sent,console.log(r),n.setState({player:r});case 16:case"end":return t.stop()}},t)}))),b(Object(g.default)(n),"onHighlight",function(t,e){var l=n.state.allCells[_({x:t,y:e})]||{};n.setState({highlighCell:l,canMoveThere:n.canMove(t,e)})}),b(Object(g.default)(n),"login",function(){n.walletAccount.requestSignIn(M,W)}),b(Object(g.default)(n),"logout",function(){}),b(Object(g.default)(n),"canMove",function(t,e){if(!n.state.player)return!1;var l=t-n.state.player.location.x,r=e-n.state.player.location.y;return l*l+r*r<=49}),b(Object(g.default)(n),"movePlayer",function(){if(n.state.canMoveThere){var t=n.state.highlighCell.location.x-n.state.player.location.x,e=n.state.highlighCell.location.y-n.state.player.location.y;n.contract.move({dx:t,dy:e}).then(function(){var t=n.walletAccount.getAccountId();n.contract.getPlayer({accountId:t}).then(function(){var e=Object(s.default)(a.a.mark(function e(l){return a.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return console.log(l),n.setState({player:l}),e.next=4,n.fetchCells(t);case 4:case"end":return e.stop()}},e)}));return function(t){return e.apply(this,arguments)}}())})}}),n.state={cells:{},allCells:{},highlighCell:{},canMoveThere:!1,player:null},n.walletAccount=null,n}return Object(y.default)(e,t),Object(f.default)(e,[{key:"componentDidMount",value:function(){var t={};r()(localStorage).forEach(function(e){if(e.startsWith(A))try{var n=JSON.parse(window.localStorage.getItem(e));A+N(n)==e&&(t[N(n)]=n)}catch(l){}}),this.setState({allCells:t}),this.nearConnect()}},{key:"render",value:function(){var t;t=this.walletAccount&&this.walletAccount.isSignedIn()?k.a.createElement(S,{accountId:this.walletAccount.getAccountId(),onClick:this.logout}):k.a.createElement(T,{onClick:this.login});var e=null;return this.state.player&&(e=this.state.cells[_(this.state.player.location)]),k.a.createElement("div",null,t,k.a.createElement(I,{width:640,height:425,cellWidth:20,cellHeight:20,cells:this.state.cells,allCells:this.state.allCells,onHighlight:this.onHighlight,playerX:this.state.player&&this.state.player.location.x,playerY:this.state.player&&this.state.player.location.y,onClick:this.movePlayer}),k.a.createElement("div",null,"Highlighted cell: ",E()(this.state.highlighCell)),k.a.createElement("div",null,"Player: ",E()(this.state.player)),e&&k.a.createElement(P,{url:e.webUrl,contractId:e.contractId}))}}]),e}(k.a.Component);function J(){return k.a.createElement("div",null,k.a.createElement(x.a,null,k.a.createElement("script",{src:"https://cdn.jsdelivr.net/npm/nearlib@0.4.2/dist/nearlib.js"})),k.a.createElement("div",null,k.a.createElement(R,null)))}},YFqc:function(t,e,n){t.exports=n("cTJO")},cTJO:function(t,e,n){"use strict";var l=n("KI45"),r=l(n("9Jkg")),o=l(n("iZP3")),a=l(n("/HRN")),i=l(n("WaGi")),c=l(n("ZDA2")),s=l(n("/+P4")),u=l(n("N9n2")),p=function(t){if(t&&t.__esModule)return t;var e={};if(null!=t)for(var n in t)Object.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e.default=t,e},h=function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0});var f=n("CxY0"),d=p(n("q1tI")),v=(h(n("17x9")),p(n("20a2"))),g=n("Bu4q");var y=function(t){function e(){var t,n,l,r,i;return(0,a.default)(this,e),(t=(0,c.default)(this,(0,s.default)(e).apply(this,arguments))).formatUrls=(n=function(t,e){return{href:t&&"object"===(0,o.default)(t)?g.formatWithValidation(t):t,as:e&&"object"===(0,o.default)(e)?g.formatWithValidation(e):e}},l=null,r=null,i=null,function(t,e){if(t===l&&e===r)return i;var o=n(t,e);return l=t,r=e,i=o,o}),t.linkClicked=function(e){var n=e.currentTarget,l=n.nodeName,r=n.target;if("A"!==l||!(r&&"_self"!==r||e.metaKey||e.ctrlKey||e.shiftKey||e.nativeEvent&&2===e.nativeEvent.which)){var o=t.formatUrls(t.props.href,t.props.as),a=o.href,i=o.as;if(function(t){var e=f.parse(t,!1,!0),n=f.parse(g.getLocationOrigin(),!1,!0);return!e.host||e.protocol===n.protocol&&e.host===n.host}(a)){var c=window.location.pathname;a=f.resolve(c,a),i=i?f.resolve(c,i):a,e.preventDefault();var s=t.props.scroll;null==s&&(s=i.indexOf("#")<0),v.default[t.props.replace?"replace":"push"](a,i,{shallow:t.props.shallow}).then(function(t){t&&s&&(window.scrollTo(0,0),document.body.focus())}).catch(function(e){t.props.onError&&t.props.onError(e)})}}},t}return(0,u.default)(e,t),(0,i.default)(e,[{key:"componentDidMount",value:function(){this.prefetch()}},{key:"componentDidUpdate",value:function(t){(0,r.default)(this.props.href)!==(0,r.default)(t.href)&&this.prefetch()}},{key:"prefetch",value:function(){if(this.props.prefetch&&"undefined"!=typeof window){var t=window.location.pathname,e=this.formatUrls(this.props.href,this.props.as).href,n=f.resolve(t,e);v.default.prefetch(n)}}},{key:"render",value:function(){var t=this,e=this.props.children,n=this.formatUrls(this.props.href,this.props.as),l=n.href,r=n.as;"string"==typeof e&&(e=d.default.createElement("a",null,e));var o=d.Children.only(e),a={onClick:function(e){o.props&&"function"==typeof o.props.onClick&&o.props.onClick(e),e.defaultPrevented||t.linkClicked(e)}};return!this.props.passHref&&("a"!==o.type||"href"in o.props)||(a.href=r||l),a.href&&"undefined"!=typeof __NEXT_DATA__&&__NEXT_DATA__.nextExport&&(a.href=v.Router._rewriteUrlForNextExport(a.href)),d.default.cloneElement(o,a)}}]),e}(d.Component);e.default=y},fW1p:function(t,e,n){var l=n("Y7ZC"),r=n("E8gZ")(!1);l(l.S,"Object",{values:function(t){return r(t)}})},nhzr:function(t,e,n){n("fW1p"),t.exports=n("WEpk").Object.values},"oh+g":function(t,e,n){var l=n("WEpk"),r=l.JSON||(l.JSON={stringify:JSON.stringify});t.exports=function(t){return r.stringify.apply(r,arguments)}},vlRD:function(t,e,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){var t=n("RNiq");return{page:t.default||t}}])}},[["vlRD",1,0]]]);